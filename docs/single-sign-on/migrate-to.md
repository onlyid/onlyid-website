import migrate1 from "@site/static/img/docs-migrate1.png";
import migrate2 from "@site/static/img/docs-migrate2.png";
import migrate3 from "@site/static/img/docs-migrate3.png";
import one2 from "@site/static/img/sso-one2.png";

# 迁移到SSO

## 简介

如果你的应用已经自建了登录模块，你可以**渐进式**迁移到SSO。

迁移流程非常简单，只需要把SSO当作另一个"微信登录"，提示用户做一次绑定即可。

下面以APP为例进行说明，网站迁移过程类似，请一并参考。

## 添加SSO登录

### 并列展示SSO和自有登录

一个传统的登录页类似下图，以自有登录为主，下方搭配社交登录：

<img src={migrate1} alt="migrate1" className="docs__img3" />

把自有登录逻辑提取到新页面，空出来的位置并列展示"用唯ID登录"和"老用户登录"按钮：

<img src={migrate2} alt="migrate2" className="docs__img3" />

接下来根据用户选择的不同登录方式，进行相应的逻辑处理。

### 用户选择"用唯ID登录"

如果用户选择"用唯ID登录"，就调起SSO功能进行登录认证，完成认证后，按原来**自有登录**流程继续进行。一般是查询数据库判断该用户是否是新用户，如果是，则进行一些必要的初始化操作，如果否，则直接进入应用。

### 用户选择"老用户登录"

如果用户选择"老用户登录"，则打开原来的自有登录页，待用户完成认证后，查询数据库用户表，判断用户是否已经绑定唯ID账号：

* 如果已经绑定，不做操作，正常进入应用；
* 如果未绑定，提示用户绑定唯ID账号，绑定完成后再进入应用；

<img src={migrate3} alt="migrate3" className="docs__img3" />

绑定操作分两步：

1. 首先调起SSO功能进行登录认证，完成认证后，
2. 对数据库用户表该用户的记录进行更新，关联返回的用户信息的id字段。

### 用户选择社交登录

如果用户选择社交登录，处理流程和"老用户登录"一样，都是在认证完成后，提示用户绑定唯ID账号，请参考上述流程。

## 移除其它登录

待大部分老用户都已经绑定了唯ID账号，就可以移除其它的登录方式：

<img src={one2} alt="one2" className="docs__img3" />

这一步不要操之过急，留足时间给老用户进行账号绑定。

但也不必"追求完美"，因为有小部分用户要过很久才会登录一次。对于这种极端情况，建议先进行移除变更，待用户再次使用你的应用时，通过人工客服处理，手动为他们绑定唯ID账号。

:::info 提示
唯ID推荐只保留SSO登录，但这不是强制的，你也可以不移除其它的登录方式。
:::

## 结语

本页描述了唯ID推荐的迁移流程，请开发者参考并结合自身情况进行迁移操作。

如有疑问，请联系客服。
